require=function s(c,r,a){function l(e,t){if(!r[e]){if(!c[e]){var n="function"==typeof require&&require;if(!t&&n)return n(e,!0);if(h)return h(e,!0);var i=new Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}var o=r[e]={exports:{}};c[e][0].call(o.exports,function(t){return l(c[e][1][t]||t)},o,o.exports,s,c,r,a)}return r[e].exports}for(var h="function"==typeof require&&require,t=0;t<a.length;t++)l(a[t]);return l}({GameControler:[function(t,e,n){"use strict";cc._RF.push(e,"31ca4JGNFZE0Z9pM5vPOx8C","GameControler");var a=t("defines"),s=t("global"),c=1,i=2;cc.Class({extends:cc.Component,properties:{fishPrefab:{default:null,type:cc.Prefab},cannon:{default:null,type:cc.Node}},onLoad:function(){var i=this;this.addRandomFishTime=0,this.stateAddFish=0,this.addFishStateTime=0,cc.director.getCollisionManager().enabled=!0;var o=0,t=function(n){cc.loader.loadRes(n,function(t,e){t&&cc.log("load err "+n+" = "+t),i[n]=e,++o===Object.keys(a.configMap).length&&(cc.log("系统加载完毕"),i.addCannon(),i.setAddFishState(c))})};for(var e in s.GameFactory.initGameFactory(),a.configMap)t(a.configMap[e])},update:function(t){switch(this.addFishStateTime+=t,this.stateAddFish){case c:this.addRandomFish(t),10<this.addFishStateTime&&(this.addFishStateTime=0,this.setAddFishState(i));break;case i:10<this.addFishStateTime&&(this.addFishStateTime=0,this.setAddFishState(c))}},onChangeFishType:function(){this.stateAddFish==c?this.setAddFishState(i):this.setAddFishState(c)},addRandomFish:function(t){if(this.addRandomFishTime+=t,1<this.addRandomFishTime){this.addRandomFishTime=0;var e=this[a.configMap.fishGroupConfig],n=Object.keys(e),i=Math.floor(Math.random()*n.length);this.addFishGroup(e[n[i]])}},addFishGroup:function(t){var e=t.fish_type,n=t.array,i=e[Math.floor(Math.random()*e.length)],o=this[a.configMap.bezierConfig],s=o[Object.keys(o)[Math.floor(Math.random()*Object.keys(o).length)]];this.addOneFish(i,n,s)},addOneFish:function(t,e,n){for(var i=this[a.configMap.fishConfig][t],o=0;o<e.length;o++){var s=[];for(var c in n)s.push({x:n[c].x+e[o].x*i.width,y:n[c].y+e[o].y*i.height});var r={config:i,bezier:s};this.addFishNode(r)}},addFishNode:function(t){var e=cc.instantiate(this.fishPrefab);e.parent=this.node,e.getComponent("fish").initWithData(t)},setAddFishState:function(t){this.stateAddFish!==t&&(this.stateAddFish=t)},addCannon:function(){var t=this[a.configMap.cannonConfig],e=t[Object.keys(t)[0]];this.cannon.getComponent("cannon").initWithData(e)},getCannonConfig:function(t){var e=this[a.configMap.cannonConfig],n=Object.keys(e);return t>=n.length&&(t=n.length-1),t<0&&(t=0),[e[n[t]],t]}}),cc._RF.pop()},{defines:"defines",global:"global"}],GameFactory:[function(t,e,n){"use strict";cc._RF.push(e,"ad8c7JVcJlK3oIax3Q4VQjd","GameFactory"),t("global").GameFactory={_netFrefab:null,_isInitFinish:!1,initGameFactory:function(){var n=this;cc.loader.loadRes("prefabs/fishNet",function(t,e){t&&cc.log("load err "+resPath+" = "+t),n._netFrefab=e,n._isInitFinish=!0})},createFishNet:function(){return 1==this._isInitFinish?cc.instantiate(this._netFrefab):null}},cc._RF.pop()},{global:"global"}],PermanentNode:[function(t,e,n){"use strict";cc._RF.push(e,"b2a90fNcvBFColW+LE5Msp0","PermanentNode"),cc.Class({extends:cc.Component,onLoad:function(){this.init()},init:function(){cc.view.resizeWithBrowserSize(!0),cc.view.setResizeCallback(this.resizeCallback),cc.director.on(cc.Director.EVENT_AFTER_SCENE_LAUNCH,this.resizeCallback),cc.game.addPersistRootNode(this.node),cc.director.loadScene("gameScene")},resizeCallback:function(){console.log("resizeCallback");var t=cc.find("Canvas").getComponent(cc.Canvas),e=window?window.innerWidth:cc.view.getVisibleSize().width,n=window?window.innerHeight:cc.view.getVisibleSize().height,i=e/t.designResolution.width,o=n/t.designResolution.height;i<o?(t.fitWidth=!0,t.fitHeight=!1):o<i?(t.fitWidth=!1,t.fitHeight=!0):(t.fitWidth=!1,t.fitHeight=!1)}}),cc._RF.pop()},{}],bezier:[function(t,e,n){"use strict";cc._RF.push(e,"87899xBqgBDK7wr+PI6wwqX","bezier");e.exports=function(t,e,n){var i={},s=t,c=n,o=e;function r(t,e){this.x=t||0,this.y=e||0}function a(t,e){for(var n=new r,i=t.length,o=0;o<i;o++){var s=l(i-1,o,e);n.x+=t[o].x*s,n.y+=t[o].y*s}return n}function l(t,e,n){return o=e,s=h(i=t),c=h(o)*h(i-o),s/c*Math.pow(n,e)*Math.pow(1-n,t-e);var i,o,s,c}function h(t){for(var e=1,n=1;n<=t;n++)e*=n;return e}return i.getPoints=function(t){var e=[],n=o;return t&&(n=t),function(t,e,n){var i,o;for(i=1/(e-1),o=0;o<e;o++)n[o]=a(t,o*i)}(s,n,e),e},i.getPoint=function(t){if(c<t)return null;for(var e=new r,n=s.length,i=0;i<n;i++){var o=l(n-1,i,t/c);e.x+=s[i].x*o,e.y+=s[i].y*o}return e},i},cc._RF.pop()},{}],bulletManager:[function(t,e,n){"use strict";cc._RF.push(e,"6cbdaxvT0xM7bc7kxQQatlP","bulletManager"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],bullet:[function(t,e,n){"use strict";cc._RF.push(e,"49e71K4AXhDlb2uoD/QAVV/","bullet");var i=t("global"),o=Math.PI;cc.Class({extends:cc.Component,properties:{_startPos:cc.Vec2(0,0),_action:null,_isStart:!1,_bulletId:-1,_angle:0,_bulletSpeed:0,_dx:0,_dy:0},onLoad:function(){},initBulletWithData:function(t,e){this._startPos=e,this.node.position=e,this.initActionData(t*Math.PI/180,1e3)},initActionData:function(t,e){this._angle=t,this._bulletSpeed=e,this._dx=Math.sin(this._angle),this._dy=Math.cos(this._angle)},onCollisionEnter:function(t,e){this.onBulletCollisionFish(),this.node.destroy()},onCollisionStay:function(t,e){},onCollisionExit:function(t,e){},isBulletOutWindow:function(){this.node.position;return!1},setBulletId:function(t){this._bulletId=t},onBulletCollisionFish:function(){var t=i.GameFactory.createFishNet();t.parent=this.node.parent,t.position=this.node.position},update:function(t){if(this.node){var e=this.node.getPosition(),n=this._bulletSpeed*this._dx*t,i=this._bulletSpeed*this._dy*t;e.x+=n,e.y+=i,e.x<-640&&(e.x=e.x+2*Math.abs(n),this._dx=-this._dx,this._angle=-this._angle),640<e.x&&(e.x=640-(e.x-640),this._dx=-this._dx,this._angle=-this._angle),e.y<-360&&(e.y=e.y+2*Math.abs(i),this._dy=-this._dy,this._angle=o-this._angle),360<e.y&&(e.y=360-(e.y-360),this._dy=-this._dy,this._angle=o-this._angle),this.node.setPosition(e),this.node.setRotation(180*this._angle/o)}else console.log("tagget is no nonentity")}}),cc._RF.pop()},{global:"global"}],cannon:[function(t,e,n){"use strict";cc._RF.push(e,"df043i8vLBHVbBXG1tr7/j3","cannon"),cc.Class({extends:cc.Component,properties:{spriteAtlas:{default:null,type:cc.SpriteAtlas}},onLoad:function(){},initWithData:function(t){if(t){var e=t.animates,n=this.node.getComponent(cc.Animation),i=this.node.getComponent(cc.Sprite);this.removeAnimationData();var o=this.getSpriteFrameList(e);i.spriteFrame=o[0];var s=cc.AnimationClip.createWithSpriteFrames(o,o.length);s.wrapMode=cc.WrapMode.Normal,n.defaultClip=s,n.setCurrentTime(e.speed),n.addClip(s,"run")}},playAction:function(){var t=this.node.getComponent(cc.Animation);t.stop("run"),t.play("run")},getSpriteFrameList:function(t){for(var e=t.pre,n=t.start,i=t.end,o=[],s=n;s<i+1;s++){var c=e+"_"+s;cc.log("str = "+c);var r=this.spriteAtlas.getSpriteFrame(c);o.push(r)}return o},removeAnimationData:function(){for(var t=this.getComponent(cc.Animation),e=t.getClips(),n=0;n<e.length;n++)t.removeClip(e[n],!0)}}),cc._RF.pop()},{}],defines:[function(t,e,n){"use strict";cc._RF.push(e,"39403lWwkVFR7llQDVgNbt+","defines");var i={configMap:{bezierConfig:"configs/bezier-config.json",fishConfig:"configs/fish-config.json",fishGroupConfig:"configs/fish-group-config.json",cannonConfig:"configs/cannon_config.json"}};e.exports=i,cc._RF.pop()},{}],"editor-ui":[function(t,e,n){"use strict";cc._RF.push(e,"5194ajnc85F/b/kVbGuSn/2","editor-ui"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){this.isDown=!0},buttonClick:function(t,e){switch(e){case"upDown":this.upDown(t)}},upDown:function(t){var e="up",n=520;this.isDown?(e="down",n=520,this.isDown=!1):(e="up",n=-520,this.isDown=!0);var i=cc.moveTo(.3,this.node.position.x,this.node.position.y+n);this.node.runAction(i),t.target.getChildByName("Label").getComponent(cc.Label).string=e}}),cc._RF.pop()},{}],"editor-world":[function(t,e,n){"use strict";cc._RF.push(e,"8114bQHNy9FQZnE1kP8whTU","editor-world");var s=t("bezier"),c=t("defines"),r=t("global");cc.Class({extends:cc.Component,properties:{pointPrefab:{default:null,type:cc.Prefab},controlPointPrefab:{default:null,type:cc.Prefab},scrollView:{default:null,type:cc.ScrollView},scrollViewContent:{default:null,type:cc.Node},scrollViewCellPrefab:{default:null,type:cc.Prefab}},onLoad:function(){var i=this;this.bezier=void 0,this.pointPool=[],this.controlPointList=[],this.linePointList=[];var o=this.bezierConfig=void 0;this.node.on(cc.Node.EventType.TOUCH_START,function(t){for(var e in console.log("touch start"),i.controlPointList){var n=i.controlPointList[e];cc.pDistance(n.position,i.node.parent.convertTouchToNodeSpace(t))<10&&(o=n)}}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){o&&(o.position=i.node.parent.convertTouchToNodeSpace(t))}),this.node.on(cc.Node.EventType.TOUCH_END,function(t){if(void 0===o){var e=i.node.parent.convertTouchToNodeSpace(t);i.addPoint(e)}else o=void 0}),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),cc.loader.loadRes(c.configMap.bezierConfig,function(t,e){t&&console.log("load bezier config err = "+t),i.bezierConfig=e,i.initScrollView(e);var n=Object.keys(e)[0];i.showBezier(n)}),r.event.on("choose_bezier",this.showBezier.bind(this))},onKeyUp:function(t){switch(t.keyCode){case cc.KEY.z:console.log("z down"),1<this.controlPointList.length&&this.revocationBezier();break;case cc.KEY.Delete:this.buttonClick(null,"delete")}},addPoint:function(t){console.log("pos = "+JSON.stringify(t));var e=cc.instantiate(this.controlPointPrefab);e.getComponent("point_cell").initPoint(this.controlPointList.length),e.parent=this.node.parent,e.position=t,this.controlPointList.push(e)},update:function(t){if(0!==this.controlPointList.length){var e=s(this.controlPointList,200,10).getPoints();for(var n in this.linePointList)this.node.removeChild(this.linePointList[n]);this.linePointList=[];for(var i=0;i<e.length;i++){var o=void 0;i<this.pointPool.length?o=this.pointPool[i]:(o=cc.instantiate(this.pointPrefab),this.pointPool.push(o)),o.parent=this.node,o.position=e[i],this.linePointList.push(o)}}},buttonClick:function(t,e){switch(e){case"build":if(console.log("保存"),cc.sys.isBrowser){console.log("浏览器"),this.saveBezier();var n=JSON.stringify(this.bezierConfig),i=new Blob([n],{type:"application/json"}),o=document.createElement("a");o.download="bezier-config.json",o.innerHTML="Download File",null!=window.webkitURL?o.href=window.webkitURL.createObjectURL(i):(o.href=window.URL.createObjectURL(i),o.onclick=destroyClickedElement,o.style.display="none",document.body.appendChild(o)),o.click()}break;case"save":this.saveBezier();break;case"new":this.newBezier();break;case"delete":this.removeControllerPoint(),this.removeScrollViewCell(this.currentBezierId);var s={};for(var c in this.bezierConfig)c!==this.currentBezierId&&(s[c]=this.bezierConfig[c]);this.bezierConfig=s,this.currentBezierId=void 0,console.log("bezier config = "+JSON.stringify(this.bezierConfig))}},newBezier:function(){var t="bezier_id_1";console.log("str = "+t);var e=this.getDeletion(this.bezierConfig);console.log("num = "+e);var n=t.substring(0,10)+e;this.bezierConfig[n]=[],console.log("new bezier id = "+n),this.addScrollViewCell(n),this.showBezier(n)},getDeletion:function(t){var e=Object.keys(t);e.sort(function(t,e){var n=parseInt(t.substring(10,t.length));return parseInt(e.substring(10,e.length))<n});for(var n=0;n<e.length;n++){if(n!==parseInt(e[n].substring(10,e[n].length)))return n}return e.length},saveBezier:function(){if(void 0!==this.currentBezierId){for(var t=[],e=0;e<this.controlPointList.length;e++)t.push({x:this.controlPointList[e].position.x,y:this.controlPointList[e].position.y});this.bezierConfig[this.currentBezierId]=t}},showBezier:function(t){console.log("show bezier id = "+t);var e=t;this.currentBezierId=e;var n=this.bezierConfig[e];console.log("pos list = "+n.length),this.removeControllerPoint();for(var i=0;i<n.length;i++)this.addPoint(n[i])},revocationBezier:function(){for(var t=[],e=0;e<this.controlPointList.length-1;e++)t.push({x:this.controlPointList[e].position.x,y:this.controlPointList[e].position.y});this.removeControllerPoint();for(var n=0;n<t.length;n++)this.addPoint(t[n])},initScrollView:function(t){for(var e in t)this.addScrollViewCell(e)},addScrollViewCell:function(t){console.log(" i = "+t);var e=cc.instantiate(this.scrollViewCellPrefab);this.scrollViewContent.addChild(e),e.position=cc.p(0,40*-this.scrollViewContent.children.length),e.getComponent("scroll-view-cell").init({bezierId:t})},removeScrollViewCell:function(t){for(var e=0;e<this.scrollViewContent.children.length;e++){var n=this.scrollViewContent.children[e];n.getComponent("scroll-view-cell").getCellId()===t&&this.scrollViewContent.removeChild(n)}for(var i=0;i<this.scrollViewContent.children.length;i++){this.scrollViewContent.children[i].position=cc.p(0,40*-(i+1))}},removeControllerPoint:function(){for(var t=0;t<this.controlPointList.length;t++)this.controlPointList[t].destroy();for(var e=0;e<this.linePointList.length;e++)this.node.removeChild(this.linePointList[e]);this.controlPointList=[]}}),cc._RF.pop()},{bezier:"bezier",defines:"defines",global:"global"}],"event-listener":[function(t,e,n){"use strict";cc._RF.push(e,"5ffd0cXPHpJbaaH04Smvbfs","event-listener");e.exports=function(t){var c={};return t.on=function(t,e){c.hasOwnProperty(t)?c[t].push(e):c[t]=[e]},t.fire=function(t){if(c.hasOwnProperty(t))for(var e=c[t],n=0;n<e.length;n++){for(var i=[],o=e[n],s=1;s<arguments.length;s++)i.push(arguments[s]);o.apply(this,i)}},t.removeListener=function(t,e){if(c.hasOwnProperty(t))for(var n=c[t],i=n.length-1;0<=i;i--)n[i]===e&&n.splice(i,1)},Object.removeAllListeners=function(){c={}},t},cc._RF.pop()},{}],fishManager:[function(t,e,n){"use strict";cc._RF.push(e,"864f6HFF/JJN7YCNu8tpsbg","fishManager"),cc.Class({extends:cc.Component,properties:{},start:function(){}}),cc._RF.pop()},{}],fishNet:[function(t,e,n){"use strict";cc._RF.push(e,"685c4OmaKhGmZ4G2dBqzgZk","fishNet"),cc.Class({extends:cc.Component,onLoad:function(){var t=this.getComponent(cc.Animation);t.on("finished",this.dead,this),t.play("netAnimation")},dead:function(){this.node.destroy()}}),cc._RF.pop()},{}],fish:[function(t,e,n){"use strict";cc._RF.push(e,"343bdHcjtNL9Z3sdk+gt6iu","fish");var i,o=t("bezier"),d=(i=o)&&i.__esModule?i:{default:i};var s=-1,u=1,c=2,r=3;cc.Class({extends:cc.Component,properties:{spriteAtlas:{default:null,type:cc.SpriteAtlas},_lastFishPos:{default:cc.Vec2(0,0)}},onLoad:function(){this.state=s,this.runTime=0,this._level=0},initWithData:function(t){var e=t.config,n=t.bezier,i=this.getComponent(cc.Animation),o=["run","dead"],s=e.animates;this._level=10*e.level;for(var c=0;c<o.length;c++){var r=s[o[c]],a=this.getSpriteFrameList(r),l=cc.AnimationClip.createWithSpriteFrames(a,a.length);"run"===o[c]&&(l.wrapMode=cc.WrapMode.Loop),i.defaultClip=l,i.addClip(l,o[c])}var h=this.random(e.minSpeed,e.minSpeed+20);this.bezier=(0,d.default)(n,500,h),this.setState(u)},random:function(t,e){return Math.round(Math.random()*(e-t)+t)},getSpriteFrameList:function(t){for(var e=t.pre,n=t.start,i=t.end,o=[],s=n;s<i+1;s++){var c=e+"_"+s,r=this.spriteAtlas.getSpriteFrame(c);o.push(r)}return o},setState:function(t){if(this.state!==t){switch(t){case s:break;case u:this.node.position=this.bezier.getPoint(0),this.getComponent(cc.Animation).play("run");break;case c:break;case r:var e=this.getComponent(cc.Animation);e.stop("run"),e.on("finished",this.dead,this),e.play("dead")}this.state=t}},dead:function(){this.node.destroy()},update:function(t){switch(this.runTime+=t,this.state){case u:var e=this.bezier.getPoint(this.runTime);if(null==e){this.dead();break}var n=cc.pSub(e,this.node.position),i=cc.pAngle(cc.p(1,0),n)/Math.PI*180;0<cc.pCross(cc.p(1,0),n)&&(i=360-i),this.node.position=e,this.node.rotation=i}},onCollisionEnter:function(t,e){this._level-=2*t.node._cannonLevel,this._level<1&&this.setState(r)},onCollisionStay:function(t,e){console.log("on collision stay")},onCollisionExit:function(t,e){console.log("on collision exit")}}),cc._RF.pop()},{bezier:"bezier"}],gameLayerControler:[function(t,e,n){"use strict";cc._RF.push(e,"63304teXQlM146m3151Flco","gameLayerControler");var c=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],i=!0,o=!1,s=void 0;try{for(var c,r=t[Symbol.iterator]();!(i=(c=r.next()).done)&&(n.push(c.value),!e||n.length!==e);i=!0);}catch(t){o=!0,s=t}finally{try{!i&&r.return&&r.return()}finally{if(o)throw s}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};cc.Class({extends:cc.Component,properties:{gameCannon:{default:null,type:cc.Node},gameBg:{default:null,type:cc.Node},bulletPrefab:{default:null,type:cc.Prefab},netPrefab:{default:null,type:cc.Prefab},_cannonPos:cc.Vec2(0,0),_cannonScript:null,_cannonLevel:0},onLoad:function(){this.node.on("touchstart",function(t){this.onTouchStart(t)},this),this.initCannonPos(),this._cannonLevel=1},initCannonPos:function(){this._cannonPos=new cc.Vec2(-214,-320),this._cannonScript=this.gameCannon.getComponent("cannon")},onTouchStart:function(t){var e=t.getLocation();e=this.node.convertToNodeSpaceAR(e);var n=cc.pSub(e,this._cannonPos),i=cc.pAngle(cc.p(0,1),n)/Math.PI*180;0<cc.pCross(cc.p(0,1),n)&&(i*=-1),this.gameCannon.rotation=i,this.initCannonPos(),this._cannonScript.playAction(),this.createBullet(i,this._cannonPos)},createBullet:function(t,e){var n=cc.instantiate(this.bulletPrefab);n.parent=this.node,n.position=e,n._cannonLevel=this._cannonLevel,n.setRotation(t),n.getComponent("bullet").initBulletWithData(t,e)},onAddCannon:function(t,e){var n,i=this._cannonLevel+1,o=this.node.getComponent("GameControler").getCannonConfig(i),s=c(o,2);n=s[0],this._cannonLevel=s[1],this._cannonScript.initWithData(n)},onSubCannon:function(t,e){var n,i=this._cannonLevel-1,o=this.node.getComponent("GameControler").getCannonConfig(i),s=c(o,2);n=s[0],this._cannonLevel=s[1],this._cannonScript.initWithData(n)}}),cc._RF.pop()},{}],global:[function(t,e,n){"use strict";cc._RF.push(e,"1b60eM5TnlAGp6KPXIVbbvY","global");var i,o=t("event-listener"),s=(i=o)&&i.__esModule?i:{default:i};var c={};c.event=(0,s.default)({}),e.exports=c,cc._RF.pop()},{"event-listener":"event-listener"}],point_cell:[function(t,e,n){"use strict";cc._RF.push(e,"1e543VJ9s9PlalSNBIGaxf4","point_cell"),cc.Class({extends:cc.Component,properties:{indexLabel:cc.Label},onLoad:function(){},initPoint:function(t){this.indexLabel&&(this.indexLabel.string=t.toString())}}),cc._RF.pop()},{}],"scroll-view-cell":[function(t,e,n){"use strict";cc._RF.push(e,"e7098I3X/VPr6Tis2m4gzS9","scroll-view-cell");var i=t("global");cc.Class({extends:cc.Component,properties:{checkButton:{default:null,type:cc.Toggle},label:{default:null,type:cc.Label}},onLoad:function(){i.event.on("choose_bezier",this.chooseBezier.bind(this)),this.checkButton.interactable=!1},chooseBezier:function(t){console.log("选中了一条曲线"+t),this.checkButton.isChecked=!1,t===this.bezierId&&(this.checkButton.isChecked=!0)},init:function(t){this.bezierId=t.bezierId,this.label.string=this.bezierId},onButtonClick:function(t,e){i.event.fire("choose_bezier",this.bezierId)},getCellId:function(){return this.bezierId}}),cc._RF.pop()},{global:"global"}]},{},["editor-ui","editor-world","point_cell","scroll-view-cell","defines","GameControler","GameFactory","PermanentNode","gameLayerControler","bulletManager","fishManager","bullet","cannon","fish","fishNet","global","event-listener","bezier"]);